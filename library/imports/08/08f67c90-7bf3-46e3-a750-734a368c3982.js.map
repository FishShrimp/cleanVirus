{"version":3,"sources":["..\\..\\..\\..\\assets\\script/assets\\script\\VirusMake.js"],"names":["cc","Class","extends","Component","properties","m_VirusPrefab","Prefab","m_animDie","m_VirusParentl","Node","ctor","m_VirusSleep","onLoad","window","gVirusMake","dieAnimPool","NodePool","virusPool","Array","i","length","m_BriefHp","level","gDataCtl","GetCurLevelDesign","m_NextBrieValue","GetLDData","next","Reset","m_Brief","start","begin","m_AllHp","hp","j","m_CurHp","gVirusHpView","changeProgress","nextBrief","scale","color","type","random","virus","node","createVirus","js","getComponent","randHp","setHp","setDieGold","_color","Color","setColor","_scale","setScale","sleep","a","Play","MoveOut","scheduleOnce","bind","MoveIn","id","size","get","instantiate","parent","init","onVirusKilled","put","onVirusKilledAll","children","createGoldMoveAnim","m_DieGold","count","pos","getPosition","x","y","gGameCtl","createGoldAnim","v2","m_CoinNode","gold","AddGold","createDieAnim","getScale","m_CurColor","anim","Animation","playOver","onDieAnimKilled","play","sleepVirus","unsleepVirus","hit","value","gTouchCtl","setCanTouch","gBrief","onShowView"],"mappings":"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","file":"VirusMake.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        m_VirusPrefab:[cc.Prefab],\r\n        m_animDie:cc.Prefab,\r\n        m_VirusParentl:cc.Node,\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n    ctor:function(){\r\n        \r\n        this.m_VirusSleep = false;\r\n    },\r\n    onLoad () {\r\n        window.gVirusMake = this;\r\n        this.dieAnimPool = new cc.NodePool();\r\n        this.virusPool = new Array();\r\n        for (var i = 0; i < this.m_VirusPrefab.length; i++) {\r\n            this.virusPool[i] = new cc.NodePool();\r\n        }\r\n        this.m_BriefHp = 0;\r\n        var level = gDataCtl.GetCurLevelDesign();\r\n        this.m_NextBrieValue = gDataCtl.GetLDData(level).next;\r\n    },\r\n    Reset:function(){\r\n        this.m_BriefHp = 0;\r\n        var level = gDataCtl.GetCurLevelDesign();\r\n        this.m_NextBrieValue = gDataCtl.GetLDData(level).next;\r\n        this.m_Brief = 0;\r\n        this.m_VirusSleep = false;\r\n    },\r\n    start () {\r\n\r\n    },\r\n    begin:function(){\r\n        this.m_Brief = 0;\r\n        var level = gDataCtl.GetCurLevelDesign();\r\n        this.m_AllHp = 0;\r\n        for (var i = 0; i < gDataCtl.GetLDData(level).hp.length; i++) {\r\n            for (var j = 0; j < gDataCtl.GetLDData(level).hp[i].length; j++) {\r\n                this.m_AllHp += gDataCtl.GetLDData(level).hp[i][j];\r\n            }\r\n        }\r\n        this.m_CurHp = this.m_AllHp;\r\n        \r\n        gVirusHpView.changeProgress(1);\r\n        this.nextBrief();\r\n    },\r\n    nextBrief:function(){\r\n\r\n        var level = gDataCtl.GetCurLevelDesign();\r\n        if( this.m_Brief >= gDataCtl.GetLDData(level).hp.length ){\r\n            return;\r\n        }\r\n\r\n        var hp = gDataCtl.GetLDData(level).hp[this.m_Brief];\r\n        var scale = gDataCtl.GetLDData(level).scale;\r\n        var color = gDataCtl.GetLDData(level).color;\r\n        for (var i = 0; i < hp.length; i++) {\r\n            var type = random(0,gDataCtl.GetLDData(level).virus.length);\r\n            var node = this.createVirus(type);\r\n            var js = node.getComponent(''+type);\r\n            if( js != null ){\r\n\r\n                var randHp = hp[i];\r\n                this.m_BriefHp += randHp;\r\n                js.setHp(randHp);\r\n                js.setDieGold(randHp);\r\n                var _color = color[''+randHp]?color[''+randHp]:new cc.Color(255,255,166);\r\n                js.setColor(_color,color);\r\n                var _scale = scale[''+randHp]?scale[''+randHp]:0.6;\r\n                js.setScale(_scale);\r\n                if( this.m_VirusSleep ){\r\n                    js.sleep(true);\r\n                }\r\n            }else{\r\n                var a ;\r\n                a = 1;\r\n            }\r\n        }\r\n        this.m_Brief++;\r\n    },\r\n    Play(){\r\n    },\r\n    MoveOut:function(){\r\n        this.scheduleOnce(function(){\r\n            this.begin();\r\n        }.bind(this),1.5)\r\n    },\r\n    MoveIn:function(){\r\n\r\n    },\r\n    createVirus:function(id){\r\n        var virus = null;\r\n        if (this.virusPool[id].size() > 0) { \r\n            virus = this.virusPool[id].get();\r\n        } else { \r\n            virus = cc.instantiate(this.m_VirusPrefab[id]);\r\n        }\r\n        virus.parent = this.m_VirusParentl; // \r\n        var js = virus.getComponent(''+id);\r\n        js.init();\r\n        virus.id = id;\r\n        return virus;\r\n    },\r\n    onVirusKilled:function(virus){\r\n        var js = virus.getComponent(''+virus.id);\r\n        // if( js != null)js.stopAllActions();\r\n        var id = virus.id;\r\n        this.virusPool[id].put(virus); // 和初始化时的方法一样，将节点放进对象池，这个方法会同时调用节点的 removeFromParent\r\n\r\n    },\r\n    onVirusKilledAll:function(){\r\n        var children = this.m_VirusParentl.children;\r\n        for (var i = 0; i != children.length; ) {\r\n            this.onVirusKilled(children[i]);\r\n        }\r\n    },\r\n    createGoldMoveAnim:function(virus){\r\n\r\n        var js = virus.getComponent(''+virus.id);\r\n        if(js.m_DieGold>0){\r\n            var count = js.m_DieGold;\r\n            count = count>36?36:count;\r\n            var pos = virus.getPosition();\r\n            pos.x -= 450;\r\n            pos.y -= 800;\r\n            gGameCtl.createGoldAnim(pos,cc.v2(-214,572),\r\n            gVirusHpView.m_CoinNode,\r\n            300,count,js.m_DieGold,\r\n            function(gold){\r\n                gVirusHpView.AddGold(gold);\r\n            }.bind(this));\r\n        }\r\n    },\r\n    createDieAnim:function(node){\r\n        this.createGoldMoveAnim(node);\r\n        var pos = node.getPosition();\r\n        var scale = node.getScale();\r\n        var js = node.getComponent(''+node.id)\r\n        var color = js.m_CurColor;\r\n\r\n        var anim ;\r\n        if (this.dieAnimPool.size() > 0) { \r\n            anim = this.dieAnimPool.get();\r\n        } else { \r\n            anim = cc.instantiate(this.m_animDie);\r\n        }\r\n        anim.parent = this.m_VirusParentl;\r\n        \r\n        anim.x = pos.x;\r\n        anim.y = pos.y;\r\n        anim.setScale(cc.v2(scale*2,scale*2));\r\n        anim.color = color;\r\n\r\n        var js = anim.getComponent(cc.Animation);\r\n        js.playOver = function(){\r\n            this.onDieAnimKilled(anim);\r\n        }.bind(this)\r\n        js.play('die');\r\n    },\r\n    onDieAnimKilled:function(node){\r\n        this.dieAnimPool.put(node);\r\n    },\r\n\r\n    //sleep 是否休眠,pro 速度比例\r\n    sleepVirus:function(){\r\n        this.m_VirusSleep = true;\r\n        var children = this.m_VirusParentl.children;        \r\n        for (var i = 0; i < children.length; i++) {\r\n            var js = children[i].getComponent(''+children[i].id)\r\n            if( js != null){\r\n                js.sleep(true);\r\n            }\r\n        }\r\n    },\r\n    unsleepVirus:function(){\r\n        this.m_VirusSleep = false;\r\n        var children = this.m_VirusParentl.children;        \r\n        for (var i = 0; i < children.length; i++) {\r\n            var js = children[i].getComponent(''+children[i].id)\r\n            if( js != null){\r\n                js.sleep(false);\r\n            }\r\n        }\r\n    },\r\n    hit:function(value){\r\n        this.m_BriefHp += value;\r\n        this.m_CurHp += value;\r\n        if( this.m_BriefHp < this.m_NextBrieValue){\r\n            this.nextBrief();\r\n        }\r\n        gVirusHpView.changeProgress(this.m_CurHp/this.m_AllHp);\r\n        if(this.m_CurHp == 0 ){\r\n            gTouchCtl.setCanTouch(false);\r\n            gBrief.onShowView(this.m_CurHp);\r\n        }\r\n    },\r\n    // update (dt) {},\r\n});\r\n"]}